<!DOCTYPE html>
<html lang="en"> 
    <head>
        <title>Home</title>
        <!-- Bootstrap -->
            <!-- Responsive screen size -->
                <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
            <!-- End of responsive screen size -->
            <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
            
        <!-- End of Bootstrap -->
            <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,500,700,900" rel="stylesheet">
    <!-- Simple line Icon -->
        <link rel="stylesheet" type="text/css" href="../stylesheets/home.css"> 
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
        
    <!-- Particles -->
        <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
        
        <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>

        <script>
            particlesJS.load('particles-js', '../json/particles.json');
        </script>
        
    <!-- End of Particles -->
    <link rel="stylesheet" type="text/css" href="../stylesheets/notifications.css"> 
    </head>
<body>
    
<nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
  <a class="navbar-brand" href="/"><img id="AkuraBrand"src="../images/img/GwaGx2B.png" ></a>
  
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
    </ul>
     <ul class="nav navbar-nav navbar-right">
        <% if(!currentUser){ %>
            <a  id="register"href="/login">
              <button class="custombtn btn btn-outline-primary btn-sm" type="submit">Log In</span></button>
            </a>
        <% } else { %>
            <li class="nav-item dropdown" >
                  <a class="nav-link text-light" id="bell"  href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fa fa-bell" style='font-size: 18px; padding-top:5px'></i>
                    <span id="ball"></span>
                  </a>
                    <ul class="dropdown-menu" id="notifs" style="box-shadow: 0px 0px 1px 5000px rgba(0,0,0,0.6);">
                      <li class="head text-light bg-dark">
                        <div class="row">
                          <div class="col-lg-12 col-sm-12 col-12">
                            <span>Notifications</span>
                          </div>
                        </div>
                      </li>
                    </ul>
                </li>
            <li class="navbar-nav nav-link">
                <a class="links"  href="/student/profile">
                  <%=currentUser.username%> 
                  <img src="../images/users/<%=currentUser.username%>.jpg" onerror="imgError(this);" class="rounded-circle border user-image"  id="img">
                </a>
            </li>
            <li class="navbar-nav nav-link">
                <a  id="register"href="/logout">
                  <button class="btn btn-outline-primary btn-sm custombtn" type="submit">Logout</button>
                </a>
            </li>
        <% } %>
    </ul>
  </div>
</nav>
<div id="particles-js">
    <div id="overlay" style="width:100%">
    <!--============================= DETAIL =============================-->
    <h2 id="topic" style="margin-bottom:-20px"></h2> 
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-4 col-md-5 responsive-wrap">
                    <div class="row">
                        <div class="col-lg-11 featured-responsive c2" style=" margin: 0 auto;">
                            <div class="featured-place-wrap">
                                <a href="/student/payments">
                                    <div class="image" style="height:135px;">
                                        <img src="https://i.pinimg.com/originals/a5/d2/1a/a5d21aab5e18630975ae7e02eaa37af2.jpg" class="img-fluid" alt="#" style="position: relative; top:-60px">
                                    </div>
                                    <span class="featured-rating-yellow"><i class="fas fa-money-bill-alt"></i></span>
                                    <div class="featured-title-box" style="height:130px;">
                                        <h6>Payments</h6>
                                        <p>View payment history </p>
                                        <div class="bottom-icons">
                                            <div class="closed-now">Click Here to View Your Payments</div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>    
                    </div>
                    <div class="row">
                        <div class="col-lg-11 featured-responsive c2" style=" margin: 0 auto;" data-toggle="modal" data-target="#classes">
                            <div class="featured-place-wrap">
                                <a href="#">
                                    <div class="image" style="height:135px;">
                                        <img src="https://www.touteleurope.eu/fileadmin/_processed_/0/7/politique-euro-formation-education-a387ed0502.jpg" class="img-fluid" alt="#" style="position: relative; top:-110px">
                                    </div>
                                    <span class="featured-rating-green"><i class="fas fa-book-open"></i></span>
                                    <div class="featured-title-box" style="height:130px;">
                                        <h6>My Courses</h6>
                                        <p>Slides</p> <span>• </span>
                                        <p>Questions</p> <span> • </span>
                                        <p>Answers</p>
                                        <div class="bottom-icons">
                                            <div class="closed-now">View Course Content of Your Classes</div>
                                        </div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-8 col-md-7 responsive-wrap">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel panel-default panel-fill">
                                <div class="panel-body clck">
                                    <h1>Your next class is in</h1>
                                        <%if (firstTime[0].login===0){%>
                                           
                                        <% } %>
                                    <div class="row class-details">
                                        <div class="col-lg-6">
                                            <div id="clockdiv">
                                              <div>
                                                <span class="days">00</span>
                                                <div class="smalltext">Days</div>
                                              </div>
                                              <div>
                                                <span class="hours">00</span>
                                                <div class="smalltext">Hours</div>
                                              </div>
                                              <div>
                                                <span class="minutes">00</span>
                                                <div class="smalltext">Minutes</div>
                                              </div>
                                              <div>
                                                <span class="seconds">00</span>
                                                <div class="smalltext">Seconds</div>
                                              </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-6">
                                            <ol class="inner-details-ol"></ol>
                                                <li class="inner-details-li" style="margin-bottom:30px">Class : <span id="cls"></li>
                                                <li class="inner-details-li">Hall  : <span id="hall"></li>
                                            </ol>  
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-12" style="margin: 0 auto;">
                            <div class="panel panel-default panel-fill">
                                <div class="panel-body" style="background-color:rgba(0,0,0,0.5); border-radius: 5px;">
                                    <div class="row">
                                        <div class="col-lg-12 col-12 comment-main rounded">
                                            <ul class="p-0">
                                                <% for(var i=0; i<posts.length; i++) { %>
                                                    <li>
                                                        <a href="/student/news">
                                                            <div class="row comment-box p-1 pt-3 pr-4">
                                                                <div class="col-lg-1 col-3 user-img text-center">
                                                                    <img src="/../images/users/admin.png" style="margin-left:10px;" class="main-cmt-img">
                                                                </div>
                                                                <div class="col-lg-11 col-9 user-comment bg-light rounded pb-1">
                                                                    <div class="row">
                                                                        <div class="col-lg-12 col-12 border-bottom pr-0">
                                                                            <h6 style="padding-top:5px; font-size:15px;  color:black"><%=posts[i].title%></h6>
                                                                            <p class="w-100 m-0 font-black"><%=posts[i].content%></p>
                                                                        </div>
                                                                    </div> 
                                                                    <div class="user-comment-desc p-1 pl-2" style="height:25px;">
                                                                        <p class="m-0 mr-2" style="font-size:12px">Posted <%=moment(posts[i].created).format('MMMM Do YYYY, h:mm:ss a');%> by Admin</p>                      
                                                                    </div>    
                                                                </div>
                                                            </div>
                                                        </a>
                                                    </li>
                                                   <% if(i==1) break %>
                                                <% } %>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>    
                        </div>
                    </div>
                </div> 
            </div>
        </div>
    </div>
</div>                     
            
                        
                        
                        
<div class="modal fade" id="classes" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLabel">Select Class</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color:white;">&times;</span>
                </button>
            </div>
    
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row" style="margin-top:20px;">
                        <% for(var i=0; i<myself.length; i++){ %>
                            <div class="col-lg-6 col-md-6 featured-responsive c2">
                                <div class="featured-place-wrap"  data-toggle="modal" data-target="#classesMenu">
                                    <a href="#" class="class-btn" onclick="getClass(this)" id="<%= myself[i].subID%>">
                                        <div class="image">
                                            <img src="../images/subjects/maths<%= i%3 %>.jpg" style="height:100%" class="img-fluid" alt="#">
                                        </div>
                                        <div class="featured-title-box inner-title">
                                            <h6 style="margin:-10px"><%= myself[i].year+" - "+myself[i].subname%></h6>
                                            <div class="bottom-icons">
                                                <div class="closed-now">Click Here to Go to The Menu</div>
                                            </div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                        
<div class="modal fade" id="classesMenu" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg class-menu" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title" id="exampleModalLabel">Class Menu</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true" style="color:white;">&times;</span>
                </button>
            </div>
    
            <div class="modal-body">
                <div class="container-fluid">
                    <div class="row" style="margin-top:20px;">
                        <div class="col-lg-4 col-md-4 featured-responsive c2">
                            <div class="featured-place-wrap">
                                <a href="#" onclick="discussions()">
                                    <div class="image">
                                        <img src="https://media.glassdoor.com/l/c4/b0/4d/1f/discussion-time.jpg" class="img-fluid" alt="#">
                                    </div>
                                    <div class="featured-title-box inner-title">
                                        <h6 style="margin:-10px">Discussion Forums</h6>
                                        <ul>
                                            <li><span class="icon-location-pin"></span>
                                                <p>Discuss problems with your friends</p>
                                            </li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 featured-responsive c2">
                            <div class="featured-place-wrap">
                                <a href="#" onclick="content()">
                                    <div class="image">
                                        <img src="https://itradeico.com/wp-content/uploads/2018/06/books-1024x535.png" style="height:100%" class="img-fluid" alt="#">
                                    </div>
                                    <div class="featured-title-box inner-title">
                                        <h6 style="margin:-10px">View Course Content</h6>
                                        <ul>
                                            <li><span class="icon-location-pin"></span>
                                                <p>Download course related notes</p>
                                            </li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 featured-responsive c2">
                            <div class="featured-place-wrap">
                                <a href="#" onclick="results()">
                                    <div class="image">
                                        <img src="https://www.dbs.com.sg/iwov-resources/images/sgsme/dbscontent/freetext/wc-articles/financial-planning-analysis.jpg" style="height:100%" class="img-fluid" alt="#">
                                    </div>
                                    <div class="featured-title-box inner-title">
                                        <h6 style="margin:-10px">View Results</h6>
                                        <ul>
                                            <li><span class="icon-location-pin"></span>
                                                <p>View an analysis of results</p>
                                            </li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div>
                        <div class="col-lg-4 col-md-4 featured-responsive c2">
                            <div class="featured-place-wrap">
                                <a href="#" onclick="submit()">
                                    <div class="image">
                                        <img src="https://www.dbs.com.sg/iwov-resources/images/sgsme/dbscontent/freetext/wc-articles/financial-planning-analysis.jpg" style="height:100%" class="img-fluid" alt="#">
                                    </div>
                                    <div class="featured-title-box inner-title">
                                        <h6 style="margin:-10px">Submission</h6>
                                        <ul>
                                            <li><span class="icon-location-pin"></span>
                                                <p>Make a submission for an available post.</p>
                                            </li>
                                        </ul>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>      
<script>
function imgError(image) {
    image.onerror = "";
    image.src = "../images/users/student.png";
    return true;
}

var myself = <%-JSON.stringify(myself)%>;
Date.prototype.addDays = function(days) {
    var date = new Date(this.valueOf());
    date.setDate(date.getDate() + days);
    return date;
}

var today = new Date().getDay();
var days=[ "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"]
var closest = myself[1] //choose closest as the first myself record
var count=0
var minCount=8 //minimum count of days have to be less than 7

myself.forEach(function(m){
    count=0
    for(var i=today; i<today+7; i++){ //goes around from today's position
        if(m.day==days[i%7]){ 
            if(minCount>count){
                closest=m
                minCount=count+1 //setting the minimum count
            }
           break
        }
        
        count++
    }
})

$("#cls").append(closest.subID+" "+closest.subname+" "+closest.year)
$("#hall").append(closest.hall)

var closestTime = new Date (new Date().toDateString() + ' ' + closest.fromTime) //coz js does not have date, it has date time. giving today's date as a dummy value

// Set the date we're counting down to
var countDownDate = new Date(closestTime.addDays(minCount)).getTime();

// Update the count down every 1 second
var x = setInterval(function() {

  // Get todays date and time
  var now = new Date().getTime();

  // Find the distance between now and the count down date
  var distance = countDownDate - now;

  // Time calculations for days, hours, minutes and seconds
  var days = Math.floor(distance / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);

  // Display the result in the element
    var clock = document.getElementById('clockdiv');
    var daysSpan = clock.querySelector('.days');
    var hoursSpan = clock.querySelector('.hours');
    var minutesSpan = clock.querySelector('.minutes');
    var secondsSpan = clock.querySelector('.seconds');
    
    daysSpan.innerHTML = '0'+days;
    if(hours<10)
        hours='0' + hours
    hoursSpan.innerHTML = hours;
    if(minutes<10)
        minutes='0' + minutes
    minutesSpan.innerHTML = minutes;
    if(seconds<10)
        seconds='0' + seconds
    secondsSpan.innerHTML = seconds
    
}, 1000);

$("#bell").on('click', function(){
    document.getElementById("ball").innerHTML =''
    localStorage.setItem("viewed", "1");
})

var nOfItems = 0

$.ajax({
    url: "/student/home/notifications",
    type: "POST",
    contentType:"application/json",
    
    'success': function (data) {
        data=data.reverse()
        var i=0
        var str=''
        nOfItems=data.length
        data.forEach(function(subArray){
            if(i%2==0){
                 str='<li class="notification-box">'
            }
            else{
                 str='<li class="notification-box bg-gray">'
            }
            i++
            str=str+'<div class="row"><div class="col-lg-3 col-sm-3 col-3 text-center" style="padding-top:0px">'
            if(subArray.type=='sc')
                str=str+'<a class="aNotif" href="/student/news"><img src="../images/users/admin.png" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">Admin - Schedule Changes</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.created.substring(0,10)+'   -   '+ subArray.created.substring(12,16)+'</small></div></a></div></li>'            
            else if(subArray.type=='ps')
                str=str+'<a class="aNotif" href="/student/discussions/'+subArray.subID+'"><img src="../images/users/'+subArray.author+'.jpg" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">'+ subArray.authorName +' posted on '+ subArray.subID +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.postedAt.substring(0,10)+'   -   '+ subArray.postedAt.substring(12,16)+'</small></div></a></div></li>'            
            else if(subArray.type=='cn')                
                str=str+'<a class="aNotif" href="/student/viewCourseContent/'+subArray.subID+'"><img src="../images/misc/pdf.png" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">New course content available - '+ subArray.subID +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.created.substring(0,10)+'   -   '+ subArray.created.substring(12,16)+'</small></div></a></div></li>'            
            else
                str=str+'<a class="aNotif" href="/student/discussions/'+subArray.subID+'"><img src="../images/users/'+subArray.author+'.jpg" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">'+ subArray.authorName +' commented on '+ subArray.title +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.postedAt.substring(0,10)+'   -   '+ subArray.postedAt.substring(12,16)+'</small></div></a></div></li>'                         
            $('#notifs').append(str);                     
        })
        
        if(i==0){
            str='<li class="notification-box"><center>No new notifications</center></li>'
            $('#notifs').append(str);
            $('#notifs').append('<li class="footer bg-dark text-center"><a href="/student/notifications" class="text-light">View History</a></li>'); 
        }
        else{
            if(localStorage.getItem("viewed")!=1 || localStorage.getItem("number")!=i)
                $('#ball').append('<i class="fas fa-circle" style="margin-left:-6px; margin-bottom:-12px; padding-top:15px; color:red; font-size:10px"></i>')
            $('#notifs').append('<li class="footer bg-dark text-center"><a href="/student/notifications" class="text-light">View All</a></li>'); 
        }

        localStorage.setItem("number", i);
    }
})

setInterval(function() {
    $.ajax({
        url: "/student/home/notifications",
        type: "POST",
        contentType:"application/json",
        
        'success': function (data) {
            if(nOfItems!=data.length){
                nOfItems=data.length
                document.getElementById("ball").innerHTML =''
                document.getElementById("notifs").innerHTML =''
                $("#notifs").append('<li class="head text-light bg-dark"><div class="row"><div class="col-lg-12 col-sm-12 col-12"><span>Notifications</span></div></div></li>')
                var i=0
                var str=''
                data=data.reverse()
                data.forEach(function(subArray){
                    if(i%2==0){
                         str='<li class="notification-box">'
                    }
                    else{
                         str='<li class="notification-box bg-gray">'
                    }
                    i++
                    str=str+'<div class="row"><div class="col-lg-3 col-sm-3 col-3 text-center" style="padding-top:0px">'
                    if(subArray.type=='sc')
                        str=str+'<a class="aNotif" href="/student/news"><img src="../images/users/admin.png" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">Admin - Schedule Changes</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.created.substring(0,10)+'   -   '+ subArray.created.substring(12,16)+'</small></div></a></div></li>'            
                    else if(subArray.type=='ps')
                        str=str+'<a class="aNotif" href="/student/discussions/'+subArray.subID+'"><img src="../images/users/'+subArray.author+'.jpg" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">'+ subArray.authorName +' posted on '+ subArray.subID +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.postedAt.substring(0,10)+'   -   '+ subArray.postedAt.substring(12,16)+'</small></div></a></div></li>'            
                    else if(subArray.type=='cn')                
                        str=str+'<a class="aNotif" href="/student/viewCourseContent/'+subArray.subID+'"><img src="../images/misc/pdf.png" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">New course content available - '+ subArray.subID +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.created.substring(0,10)+'   -   '+ subArray.created.substring(12,16)+'</small></div></a></div></li>'            
                    else
                        str=str+'<a class="aNotif" href="/student/discussions/'+subArray.subID+'"><img src="../images/users/'+subArray.author+'.jpg" class="w-50 rounded-circle"></div><div class="col-lg-8 col-sm-8 col-8"><strong class="text-info">'+ subArray.authorName +' commented on '+ subArray.title +'</strong><div>'+ subArray.title +'</div><small class="text-warning">'+ subArray.postedAt.substring(0,10)+'   -   '+ subArray.postedAt.substring(12,16)+'</small></div></a></div></li>'                         
                    $('#notifs').append(str);                     
                })
                
                if(i==0){
                    str='<li class="notification-box"><center>No new notifications</center></li>'
                    $('#notifs').append(str);
                    $('#notifs').append('<li class="footer bg-dark text-center"><a href="/student/notifications" class="text-light">View History</a></li>'); 
                }
                else{
                    if(localStorage.getItem("viewed")!=1 || localStorage.getItem("number")!=i)
                        $('#ball').append('<i class="fas fa-circle" style="margin-left:-6px; margin-bottom:-12px; padding-top:15px; color:red; font-size:10px"></i>')
                    $('#notifs').append('<li class="footer bg-dark text-center"><a href="/student/notifications" class="text-light">View All</a></li>'); 
                }
        
                localStorage.setItem("number", i);
            }
        }
    })
}, 5000);
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="../scripts/studentHome.js"></script>
<% include ../partials/footer %>